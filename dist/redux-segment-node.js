!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=16)}([function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CHARS="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",t.WEB="",t.ANDROID="android",t.IOS="ios",t.SIGN_OUT="signout",t.LOG_OUT="logout",t.EVENT_TYPE_IDENTIFY="identify",t.EVENT_TYPE_GROUP="group",t.EVENT_TYPE_TRACK="track",t.EVENT_TYPE_PAGE="page",t.EVENT_TYPE_SCREEN="screen",t.EVENT_TYPE_ALIAS="alias"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.val;return e.rules.includes(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!e)throw new Error(t)}},function(e,t,n){(function(e){!function(e,t){"use strict";if(!e.setImmediate){var n,r,o,i,a,u=1,s={},c=!1,l=e.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(e);f=f&&f.setTimeout?f:e,"[object process]"==={}.toString.call(e.process)?n=function(e){Object({env:Object({NODE_ENV:"production"})}).nextTick(function(){p(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){p(e.data)},n=function(e){o.port2.postMessage(e)}):l&&"onreadystatechange"in l.createElement("script")?(r=l.documentElement,n=function(e){var t=l.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):n=function(e){setTimeout(p,0,e)}:(i="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(i)&&p(+t.data.slice(i.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),n=function(t){e.postMessage(i+t,"*")}),f.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var o={callback:e,args:t};return s[u]=o,n(u),u++},f.clearImmediate=d}function d(e){delete s[e]}function p(e){if(c)setTimeout(p,0,e);else{var n=s[e];if(n){c=!0;try{!function(e){var n=e.callback,r=e.args;switch(r.length){case 0:n();break;case 1:n(r[0]);break;case 2:n(r[0],r[1]);break;case 3:n(r[0],r[1],r[2]);break;default:n.apply(t,r)}}(n)}finally{d(e),c=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(0))},function(e,t){var n=Object.prototype.toString;e.exports=function(e){switch(n.call(e)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}if("object"==typeof e&&e&&"number"==typeof e.length)try{if("function"==typeof e.callee)return"arguments"}catch(e){if(e instanceof TypeError)return"arguments"}return null===e?"null":void 0===e?"undefined":e&&1===e.nodeType?"element":e===Object(e)?"object":typeof e}},function(e){e.exports={name:"redux-segment-node",version:"1.0.3",description:"redux middleware for segment",main:"dist/redux-segment-node.js",scripts:{dev:"NODE_ENV=development webpack-dev-server --config webpack.config.js --hot --host 0.0.0.0",lint:"eslint src/**/*.js || true",format:'prettier-eslint --write "./src/**/*.js"',build:"NODE_ENV=production webpack -p --config webpack.config.js"},repository:{type:"git",url:"git+https://github.com/wonism/redux-segment-node.git"},keywords:["redux","segment","redux-segment-node","reactjs","react-native"],author:"wonism",license:"MIT",bugs:{url:"https://github.com/wonism/redux-segment-node/issues"},homepage:"https://github.com/wonism/redux-segment-node#readme",devDependencies:{"babel-core":"^6.26.3","babel-eslint":"^8.2.3","babel-loader":"^7.1.4","babel-plugin-transform-class-properties":"^6.24.1","babel-plugin-transform-object-rest-spread":"^6.26.0","babel-polyfill":"^6.26.0","babel-preset-env":"^1.7.0","compression-webpack-plugin":"^1.1.11",eslint:"^4.19.1","eslint-config-airbnb-base":"^12.1.0","eslint-loader":"^2.0.0","eslint-plugin-import":"^2.11.0",husky:"^1.0.0-rc.6","lint-staged":"^7.1.3",prettier:"^1.12.1","prettier-eslint-cli":"^4.7.1",redux:"^4.0.0","redux-devtools-extension":"^2.13.2","uglifyjs-webpack-plugin":"^1.2.5",webpack:"^4.8.3","webpack-cli":"^2.1.3","webpack-dev-server":"^3.1.4"},dependencies:{"base-64":"^0.1.0",setimmediate:"^1.0.5","type-of":"^2.0.1"},husky:{hooks:{"pre-commit":"npm run build && lint-staged"}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Array.from(Array(e)).reduce(function(e){return e+r.CHARS[Math.floor(Math.random()*r.CHARS.length)]},"")};var r=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.text().then(function(t){var n=e;if(!n.ok){var r=new Error(n.statusText);throw r.status=n.status,r}try{n.bodyParsed=JSON.parse(t)}catch(e){n.bodyParsed=t}return n})}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(r,o){var i=n.retries,a=void 0===i?3:i;!function i(){e.fetch(t,n).then(r).catch(function(e){a?setTimeout(function(){a-=1,i()},1e3):o(e)})}()})}}).call(this,n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};t.default=function(e,t){var n=t.userId,o=t.anonymousId;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return r({},e,n?{previousId:n,anonymousId:o}:{previousId:o});if(n)return r({},e,{userId:n,anonymousId:o});return r({},e,{anonymousId:o})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){(0,o.default)("object"===(0,r.default)(e),"You must pass a message object."),a.forEach(function(t){if(e[t.name]){var n=[].concat(t.types);(0,o.default)(n.some(function(n){return(0,r.default)(e[t.name])===n}),'"'+t.name+'" must be '+n.join(" or ")+".")}})};var r=i(n(5)),o=i(n(3));function i(e){return e&&e.__esModule?e:{default:e}}var a=[{name:"anonymousId",types:["string","number"]},{name:"category",types:"string"},{name:"context",types:"object"},{name:"properties",types:"object"},{name:"traits",types:"object"},{name:"integrations",types:"object"},{name:"event",types:"string"},{name:"groupId",types:["string","number"]},{name:"name",types:"string"},{name:"previousId",types:["string","number"]},{name:"timestamp",types:"date"},{name:"userId",types:["string","number"]}]},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){(function(e,r){var o;!function(i){var a="object"==typeof t&&t,u=("object"==typeof e&&e&&e.exports,"object"==typeof r&&r);u.global!==u&&u.window;var s=function(e){this.message=e};(s.prototype=new Error).name="InvalidCharacterError";var c=function(e){throw new s(e)},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=/[\t\n\f\r ]/g,d={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&c("The string to be encoded contains characters outside of the Latin1 range.");for(var t,n,r,o,i=e.length%3,a="",u=-1,s=e.length-i;++u<s;)t=e.charCodeAt(u)<<16,n=e.charCodeAt(++u)<<8,r=e.charCodeAt(++u),a+=l.charAt((o=t+n+r)>>18&63)+l.charAt(o>>12&63)+l.charAt(o>>6&63)+l.charAt(63&o);return 2==i?(t=e.charCodeAt(u)<<8,n=e.charCodeAt(++u),a+=l.charAt((o=t+n)>>10)+l.charAt(o>>4&63)+l.charAt(o<<2&63)+"="):1==i&&(o=e.charCodeAt(u),a+=l.charAt(o>>2)+l.charAt(o<<4&63)+"=="),a},decode:function(e){var t=(e=String(e).replace(f,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&c("Invalid character: the string to be decoded is not correctly encoded.");for(var n,r,o=0,i="",a=-1;++a<t;)r=l.indexOf(e.charAt(a)),n=o%4?64*n+r:r,o++%4&&(i+=String.fromCharCode(255&n>>(-2*o&6)));return i},version:"0.1.0"};void 0===(o=function(){return d}.call(t,n,t,e))||(e.exports=o)}()}).call(this,n(12)(e),n(0))},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,o=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(o.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new i(o.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(4),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(4);var i=m(n(13)),a=n(1),u=m(n(3)),s=m(n(11)),c=m(n(10)),l=m(n(2)),f=m(n(9)),d=m(n(8)),p=m(n(7)),h=n(6);function m(e){return e&&e.__esModule?e:{default:e}}var v=function(){},y=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.platform,o=void 0===r?t.DEFAULT_PLATFORM:r,i=n.host,s=void 0===i?t.DEFAULT_HOST:i,c=n.flushAt,f=void 0===c?t.DEFAULT_FLUSH_AT:c,d=n.flushAfter,p=void 0===d?t.DEFAULT_FLUSH_AFTER:d,h=n.uid,m=void 0===h?t.DEFAULT_UID:h;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(0,u.default)(e,"You must pass your Segment project's write key."),(0,u.default)((0,l.default)({val:o,rules:[a.WEB,a.ANDROID,a.IOS]}),"Platform should be one of [`android`, `ios`] or `undefined`"),this.queue=[],this.writeKey=e,this.platform=o,this.host=s,this.flushAt=Math.max(f,1),this.flushAfter=p,this.userId=null,this.anonymousId=m}return o(t,[{key:"identify",value:function(e,t){e.userId&&(this.userId=e.userId);var n=(0,c.default)(e,this);return(0,s.default)(n),this.enqueue("identify",n,t),this}},{key:"group",value:function(e,t){var n=(0,c.default)(e,this);return(0,s.default)(n),(0,u.default)(n.groupId,"You must pass a `groupId`."),this.enqueue("group",n,t),this}},{key:"track",value:function(e,t){var n=(0,c.default)(e,this);return(0,s.default)(n),(0,u.default)(n.event,"You must pass an `event`."),this.enqueue("track",n,t),(0,l.default)({val:n.event.toLowerCase().replace(/(-|_)/g,""),rules:[a.SIGN_OUT,a.LOG_OUT]})&&(this.userId=null),this}},{key:"page",value:function(e,t){var n=(0,c.default)(e,this);return(0,s.default)(n),this.enqueue("page",n,t),this}},{key:"screen",value:function(e,t){var n=(0,c.default)(e,this);return(0,s.default)(n),this.enqueue("screen",n,t),this}},{key:"alias",value:function(e,t){var n=(0,c.default)(e,this,!0);return(0,s.default)(n),(0,u.default)(n.userId,"You must pass a `userId` for new `id`."),this.enqueue("alias",n,t),this}},{key:"flush",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v;if(!this.queue.length)return e(t);var n=this.queue.splice(0,this.flushAt),r=n.map(function(e){return e.callback});r.push(t);var o={batch:n.map(function(e){return e.message}),timestamp:new Date,sentAt:new Date};return(0,f.default)(this.host+"/v1/batch",{body:JSON.stringify(o),method:"post",headers:{Authorization:"Basic "+i.default.encode(this.writeKey),"Content-Type":"application/json; charset=utf-8","X-Requested-With":"XMLHttpRequest"},retries:5}).then(d.default).then(function(){r.forEach(function(e){e(void 0,o)})}).catch(function(e){r.forEach(function(t){t(e)})}),!0}},{key:"enqueue",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v,i=r({},t),a=this.platform?"analytics-"+this.platform:"analytics-web";i.type=e,i.context=i.context?r({},i.context):{},i.context.library={name:a,version:h.version},i.timestamp||(i.timestamp=new Date),i.messageId||(i.messageId=this.platform?this.platform+"-"+(0,p.default)(32):"web-"+(0,p.default)(32)),this.queue.push({message:i,callback:o}),this.queue.length>=this.flushAt&&this.flush(),this.timer&&clearTimeout(this.timer),this.flushAfter&&(this.timer=setTimeout(function(){return n.flush()},this.flushAfter))}}]),t}();y.DEFAULT_PLATFORM="",y.DEFAULT_HOST="https://api.segment.io",y.DEFAULT_FLUSH_AT=20,y.DEFAULT_FLUSH_AFTER=1e4,y.DEFAULT_UID=(0,p.default)(32),t.default=y}).call(this,n(14).setImmediate)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.key,n=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["key"]),u=new o.default(t,n);return function(){return function(e){return function(t){return"object"===(0,r.default)(t.analytics)&&"string"===(0,r.default)(t.analytics.eventType)&&(0,i.default)({val:t.analytics.eventType.toLowerCase(),rules:[a.EVENT_TYPE_IDENTIFY,a.EVENT_TYPE_GROUP,a.EVENT_TYPE_TRACK,a.EVENT_TYPE_PAGE,a.EVENT_TYPE_SCREEN,a.EVENT_TYPE_ALIAS]})&&"object"===(0,r.default)(t.analytics.eventPayload)&&u[t.analytics.eventType.toLowerCase()](t.analytics.eventPayload),e(t)}}}};var r=u(n(5)),o=u(n(15)),i=u(n(2)),a=n(1);function u(e){return e&&e.__esModule?e:{default:e}}}])});