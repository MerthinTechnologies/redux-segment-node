!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=16)}([function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CHARS="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",t.WEB="",t.ANDROID="android",t.IOS="ios",t.EVENT_TYPE_IDENTIFY="identify",t.EVENT_TYPE_GROUP="group",t.EVENT_TYPE_TRACK="track",t.EVENT_TYPE_PAGE="page",t.EVENT_TYPE_SCREEN="screen",t.EVENT_TYPE_ALIAS="alias"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({val:e,rules:t}){return t.includes(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!e)throw new Error(t)}},function(e,t,n){(function(e){!function(e,t){"use strict";if(!e.setImmediate){var n,r,o,s,i,a=1,u={},c=!1,l=e.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(e);f=f&&f.setTimeout?f:e,"[object process]"==={}.toString.call(e.process)?n=function(e){Object({env:Object({NODE_ENV:"production"})}).nextTick(function(){p(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){p(e.data)},n=function(e){o.port2.postMessage(e)}):l&&"onreadystatechange"in l.createElement("script")?(r=l.documentElement,n=function(e){var t=l.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):n=function(e){setTimeout(p,0,e)}:(s="setImmediate$"+Math.random()+"$",i=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&p(+t.data.slice(s.length))},e.addEventListener?e.addEventListener("message",i,!1):e.attachEvent("onmessage",i),n=function(t){e.postMessage(s+t,"*")}),f.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var o={callback:e,args:t};return u[a]=o,n(a),a++},f.clearImmediate=d}function d(e){delete u[e]}function p(e){if(c)setTimeout(p,0,e);else{var n=u[e];if(n){c=!0;try{!function(e){var n=e.callback,r=e.args;switch(r.length){case 0:n();break;case 1:n(r[0]);break;case 2:n(r[0],r[1]);break;case 3:n(r[0],r[1],r[2]);break;default:n.apply(t,r)}}(n)}finally{d(e),c=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(0))},function(e,t){var n=Object.prototype.toString;e.exports=function(e){switch(n.call(e)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}if("object"==typeof e&&e&&"number"==typeof e.length)try{if("function"==typeof e.callee)return"arguments"}catch(e){if(e instanceof TypeError)return"arguments"}return null===e?"null":void 0===e?"undefined":e&&1===e.nodeType?"element":e===Object(e)?"object":typeof e}},function(e){e.exports={name:"redux-segment-node",version:"1.0.1",description:"redux middleware for segment",main:"dist/redux-segment-node.js",scripts:{dev:"NODE_ENV=development webpack-dev-server --config webpack.config.js --hot --host 0.0.0.0",lint:"eslint src/**/*.js || true",format:'prettier-eslint --write "./src/**/*.js"',build:"NODE_ENV=production webpack -p --config webpack.config.js"},repository:{type:"git",url:"git+https://github.com/wonism/redux-segment-node.git"},keywords:["redux","segment","redux-segment-node","reactjs","react-native"],author:"wonism",license:"MIT",bugs:{url:"https://github.com/wonism/redux-segment-node/issues"},homepage:"https://github.com/wonism/redux-segment-node#readme",devDependencies:{"babel-core":"^6.26.3","babel-eslint":"^8.2.3","babel-loader":"^7.1.4","babel-plugin-transform-class-properties":"^6.24.1","babel-plugin-transform-object-rest-spread":"^6.26.0","babel-polyfill":"^6.26.0","babel-preset-env":"^1.7.0","compression-webpack-plugin":"^1.1.11",eslint:"^4.19.1","eslint-config-airbnb-base":"^12.1.0","eslint-loader":"^2.0.0","eslint-plugin-import":"^2.11.0",husky:"^1.0.0-rc.6",prettier:"^1.12.1","prettier-eslint-cli":"^4.7.1",redux:"^4.0.0","redux-devtools-extension":"^2.13.2","uglifyjs-webpack-plugin":"^1.2.5",webpack:"^4.8.3","webpack-cli":"^2.1.3","webpack-dev-server":"^3.1.4"},dependencies:{"base-64":"^0.1.0",setimmediate:"^1.0.5","type-of":"^2.0.1"},husky:{hooks:{"pre-commit":"npm run lint && npm run format && npm run build && git add ."}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Array.from(Array(e)).reduce(e=>e+r.CHARS[Math.floor(Math.random()*r.CHARS.length)],"")};var r=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.text().then(t=>{const n=e;if(!n.ok){const e=new Error(n.statusText);throw e.status=n.status,e}try{n.bodyParsed=JSON.parse(t)}catch(e){n.bodyParsed=t}return n})}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,n={}){return new Promise((r,o)=>{let{retries:s=3}=n;const i=()=>{e.fetch(t,n).then(r).catch(e=>{s?setTimeout(()=>{s-=1,i()},1e3):o(e)})};i(s)})}}).call(this,n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};t.default=function(e,{userId:t,anonymousId:n},o=!1){if(o)return r({},e,t?{previousId:t,anonymousId:n}:{previousId:n});if(t)return r({},e,{userId:t,anonymousId:n});return r({},e,{anonymousId:n})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){(0,o.default)("object"===(0,r.default)(e),"You must pass a message object."),i.forEach(t=>{if(e[t.name]){const n=[].concat(t.types);(0,o.default)(n.some(n=>(0,r.default)(e[t.name])===n),`"${t.name}" must be ${n.join(" or ")}.`)}})};var r=s(n(5)),o=s(n(3));function s(e){return e&&e.__esModule?e:{default:e}}const i=[{name:"anonymousId",types:["string","number"]},{name:"category",types:"string"},{name:"context",types:"object"},{name:"event",types:"string"},{name:"groupId",types:["string","number"]},{name:"integrations",types:"object"},{name:"name",types:"string"},{name:"previousId",types:["string","number"]},{name:"timestamp",types:"date"},{name:"userId",types:["string","number"]}]},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){(function(e,r){var o;!function(s){var i="object"==typeof t&&t,a=("object"==typeof e&&e&&e.exports,"object"==typeof r&&r);a.global!==a&&a.window;var u=function(e){this.message=e};(u.prototype=new Error).name="InvalidCharacterError";var c=function(e){throw new u(e)},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=/[\t\n\f\r ]/g,d={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&c("The string to be encoded contains characters outside of the Latin1 range.");for(var t,n,r,o,s=e.length%3,i="",a=-1,u=e.length-s;++a<u;)t=e.charCodeAt(a)<<16,n=e.charCodeAt(++a)<<8,r=e.charCodeAt(++a),i+=l.charAt((o=t+n+r)>>18&63)+l.charAt(o>>12&63)+l.charAt(o>>6&63)+l.charAt(63&o);return 2==s?(t=e.charCodeAt(a)<<8,n=e.charCodeAt(++a),i+=l.charAt((o=t+n)>>10)+l.charAt(o>>4&63)+l.charAt(o<<2&63)+"="):1==s&&(o=e.charCodeAt(a),i+=l.charAt(o>>2)+l.charAt(o<<4&63)+"=="),i},decode:function(e){var t=(e=String(e).replace(f,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&c("Invalid character: the string to be decoded is not correctly encoded.");for(var n,r,o=0,s="",i=-1;++i<t;)r=l.indexOf(e.charAt(i)),n=o%4?64*n+r:r,o++%4&&(s+=String.fromCharCode(255&n>>(-2*o&6)));return s},version:"0.1.0"};void 0===(o=function(){return d}.call(t,n,t,e))||(e.exports=o)}()}).call(this,n(12)(e),n(0))},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,o=Function.prototype.apply;function s(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new s(o.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new s(o.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(4),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};n(4);var o=h(n(13)),s=n(1),i=h(n(3)),a=h(n(11)),u=h(n(10)),c=h(n(2)),l=h(n(9)),f=h(n(8)),d=h(n(7)),p=n(6);function h(e){return e&&e.__esModule?e:{default:e}}const m=()=>{};class y{constructor(e,{platform:t=y.DEFAULT_PLATFORM,host:n=y.DEFAULT_HOST,flushAt:r=y.DEFAULT_FLUSH_AT,flushAfter:o=y.DEFAULT_FLUSH_AFTER}={}){(0,i.default)(e,"You must pass your Segment project's write key."),(0,i.default)((0,c.default)({val:t,rules:[s.WEB,s.ANDROID,s.IOS]}),"Platform should be one of [`android`, `ios`] or `undefined`"),this.queue=[],this.writeKey=e,this.platform=t,this.host=n,this.flushAt=Math.max(r,1),this.flushAfter=o,this.userId=null,this.anonymousId=(0,d.default)(32)}identify(e,t){e.userId&&(this.userId=e.userId);const n=(0,u.default)(e,this);return(0,a.default)(n),this.enqueue("identify",n,t),this}group(e,t){const n=(0,u.default)(e,this);return(0,a.default)(n),(0,i.default)(n.groupId,"You must pass a `groupId`."),this.enqueue("group",n,t),this}track(e,t){const n=(0,u.default)(e,this);return(0,a.default)(n),(0,i.default)(n.event,"You must pass an `event`."),this.enqueue("track",n,t),this}page(e,t){const n=(0,u.default)(e,this);return(0,a.default)(n),this.enqueue("page",n,t),this}screen(e,t){const n=(0,u.default)(e,this);return(0,a.default)(n),this.enqueue("screen",n,t),this}alias(e,t){const n=(0,u.default)(e,this,!0);return(0,a.default)(n),(0,i.default)(n.userId,"You must pass a `userId` for new `id`."),this.enqueue("alias",n,t),this}flush(t=m){if(!this.queue.length)return e(t);const n=this.queue.splice(0,this.flushAt),r=n.map(e=>e.callback);r.push(t);const s={batch:n.map(e=>e.message),timestamp:new Date,sentAt:new Date};return(0,l.default)(`${this.host}/v1/batch`,{body:JSON.stringify(s),method:"post",headers:{Authorization:`Basic ${o.default.encode(this.writeKey)}`,"Content-Type":"application/json; charset=utf-8","X-Requested-With":"XMLHttpRequest"},retries:5}).then(f.default).then(()=>{r.forEach(e=>{e(void 0,s)})}).catch(e=>{r.forEach(t=>{t(e)})}),!0}enqueue(e,t,n=m){const o=r({},t),s=this.platform?`analytics-${this.platform}`:"analytics-web";o.type=e,o.context=o.context?r({},o.context):{},o.context.library={name:s,version:p.version},o.timestamp||(o.timestamp=new Date),o.messageId||(o.messageId=this.platform?`${this.platform}-${(0,d.default)(32)}`:`web-${(0,d.default)(32)}`),this.queue.push({message:o,callback:n}),this.queue.length>=this.flushAt&&this.flush(),this.timer&&clearTimeout(this.timer),this.flushAfter&&(this.timer=setTimeout(()=>this.flush(),this.flushAfter))}}t.default=y,y.DEFAULT_PLATFORM="",y.DEFAULT_HOST="https://api.segment.io",y.DEFAULT_FLUSH_AT=20,y.DEFAULT_FLUSH_AFTER=1e4}).call(this,n(14).setImmediate)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e={}){const{key:t}=e,n=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["key"]),a=new o.default(t,n);return()=>e=>t=>("object"===(0,r.default)(t.analytics)&&"string"===(0,r.default)(t.analytics.eventType)&&(0,s.default)({val:t.analytics.eventType.toLowerCase(),rules:[i.EVENT_TYPE_IDENTIFY,i.EVENT_TYPE_GROUP,i.EVENT_TYPE_TRACK,i.EVENT_TYPE_PAGE,i.EVENT_TYPE_SCREEN,i.EVENT_TYPE_ALIAS]})&&"object"===(0,r.default)(t.analytics.eventPayload)&&a[t.analytics.eventType.toLowerCase()](t.analytics.eventPayload),e(t))};var r=a(n(5)),o=a(n(15)),s=a(n(2)),i=n(1);function a(e){return e&&e.__esModule?e:{default:e}}}])});